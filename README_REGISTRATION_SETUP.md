# Настройка системы регистрации с подтверждением email

## Обзор изменений

Добавлена полная система регистрации пользователей с подтверждением email через Яндекс SMTP.

## Что было добавлено

### Backend изменения:

1. **Обновлена модель User** (`backend/src/models/User.js`):
   - Добавлено поле `email` (обязательное, уникальное)
   - Добавлено поле `isVerified` (статус подтверждения email)
   - Добавлены поля `verificationToken` и `verificationExpires` для токена подтверждения
   - Добавлен метод `generateVerificationToken()` для генерации токена

2. **Обновлен контроллер авторизации** (`backend/src/controllers/authController.js`):
   - Обновлен метод `register` для работы с email и подтверждением
   - Добавлен метод `verifyEmail` для подтверждения email
   - Добавлен метод `resendVerification` для повторной отправки подтверждения
   - Обновлен метод `login` для проверки верификации email

3. **Обновлены маршруты** (`backend/src/routes/authRoutes.js`):
   - Добавлен маршрут `GET /verify-email` для подтверждения
   - Добавлен маршрут `POST /resend-verification` для повторной отправки

4. **Email сервис** (`backend/src/services/emailService.js`):
   - Уже существует и настроен для работы с Яндекс SMTP
   - Поддерживает отправку писем подтверждения

### Frontend изменения:

1. **Создана страница регистрации** (`frontend/src/views/RegisterPage.vue`):
   - Форма с полями: имя пользователя, email, пароль, подтверждение пароля
   - Валидация всех полей
   - Обработка ошибок и успешной регистрации

2. **Создана страница подтверждения email** (`frontend/src/views/VerifyEmailPage.vue`):
   - Обработка токена подтверждения из URL
   - Отображение статуса подтверждения
   - Возможность повторной отправки подтверждения

3. **Обновлена страница входа** (`frontend/src/views/LoginPage.vue`):
   - Добавлена ссылка на страницу регистрации

4. **Обновлен роутер** (`frontend/src/router/index.js`):
   - Добавлены маршруты для `/register` и `/verify-email`

## Настройка окружения

### Backend (.env файл)

Создайте файл `.env` в папке `backend/` со следующим содержимым:

```env
MONGO_URI=mongodb://localhost:27017/wbms_db
JWT_SECRET=ahuysdiueyeiudfiecudsijisjfdfisdjfhi
ADMIN_USERNAME=admin
ADMIN_PASSWORD=svamiddr
PORT=3900
FRONTEND_URL=http://217.15.53.224:5173

# Настройки SMTP для Яндекс
SMTP_HOST=smtp.yandex.ru
SMTP_PORT=587
SMTP_USER=Uniseller.io@yandex.ru
SMTP_PASS=mmjmqaukykvidqfe
```

### Frontend (.env файл)

Файл `.env` в папке `frontend/` уже настроен:

```env
VITE_API_BASE_URL=http://217.15.53.224:3900/api
```

## Установка зависимостей

### Backend
```bash
cd backend
npm install
```

### Frontend
```bash
cd frontend
npm install
```

## Запуск

### Backend
```bash
cd backend
npm start
```

### Frontend
```bash
cd frontend
npm run dev
```

## Процесс регистрации

1. **Регистрация**: Пользователь заполняет форму на `/register`
2. **Валидация**: Проверяются все поля (имя пользователя, email, пароли)
3. **Создание аккаунта**: Создается пользователь с `isVerified: false`
4. **Отправка email**: Отправляется письмо с ссылкой подтверждения
5. **Подтверждение**: Пользователь переходит по ссылке из email
6. **Активация**: Аккаунт активируется (`isVerified: true`)
7. **Вход**: Пользователь может войти в систему

## Особенности

- **Безопасность**: Пароли хешируются с помощью bcrypt
- **Валидация**: Проверка уникальности email и имени пользователя
- **Токены**: Токены подтверждения действительны 24 часа
- **Повторная отправка**: Возможность повторной отправки подтверждения
- **Обработка ошибок**: Подробные сообщения об ошибках
- **UI/UX**: Современный и удобный интерфейс

## Тестирование

1. Откройте `http://217.15.53.224:5173/register`
2. Заполните форму регистрации
3. Проверьте email для подтверждения
4. Перейдите по ссылке из письма
5. Попробуйте войти в систему

## Troubleshooting

### Проблемы с отправкой email:
- Проверьте настройки SMTP в `.env`
- Убедитесь, что пароль приложения Яндекс правильный
- Проверьте логи сервера на ошибки SMTP

### Проблемы с MongoDB:
- Убедитесь, что MongoDB запущен
- Проверьте строку подключения в `.env`

### Проблемы с фронтендом:
- Проверьте, что API URL правильный в `.env`
- Убедитесь, что backend запущен на правильном порту 